name: Publish

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  release:
    name: Archive and upload to server
    strategy:
      matrix:
        kind: ['linux']
        include:
          - kind: linux
            define: LINUX
            os: ubuntu-latest
            target: linux-x64
    runs-on: ${{ matrix.os }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: 'true'
      - name: Adding posts in archive
        uses: edgarrc/action-7z@v1
        with:
          args: 7z a -t7z -mx=9 -xr!.git -xr!.github -p${{ secrets.ARCHIVE_PASSWORD }} build.7z ./
      - name: Upload to server
        uses: sozo-design/curl@v1.0.2
        with:
          args: -F "mdarchive=@build.7z" ${{ secrets.UPLOAD_URL }}